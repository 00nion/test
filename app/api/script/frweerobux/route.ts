import { type NextRequest, NextResponse } from "next/server"
import { isRobloxRequest } from "../../utils/security"
import { compressString, encodeBase64 } from "../../utils/compression"
import crypto from "crypto"

// This is your "Free Robux" script that will be served via loadstring
const scrypt = `
([[This file was protected with MoonSec V3]]):gsub('.+', (function(a) _qstRTKZZujVh = a; end)); return(function(o,...)local c;local a;local t;local d;local l;local r;local e=24915;local n=0;local f={};while n<489 do n=n+1;while n<0x9b and e%0x1a7e<0xd3f do n=n+1 e=(e+151)%32700 local b=n+e if(e%0x12ae)>=0x957 then e=(e*0xfc)%0xc06d while n<0x27e and e%0x17f4<0xbfa do n=n+1 e=(e*687)%34459 local l=n+e if(e%0x2ba2)>=0x15d1 then e=(e*0x280)%0x12d1 local e=35742 if not f[e]then f[e]=0x1 c=tonumber;end elseif e%2~=0 then e=(e*0x3a0)%0x36f9 local e=29612 if not f[e]then f[e]=0x1 d=string;end else e=(e+0x3dd)%0x498b n=n+1 local e=95139 if not f[e]then f[e]=0x1 end end end elseif e%2~=0 then e=(e-0x38a)%0x4c64 while n<0x69 and e%0x1892<0xc49 do n=n+1 e=(e*197)%16649 local t=n+e if(e%0x1694)<0xb4a then e=(e-0x217)%0x1919 local e=14058 if not f[e]then f[e]=0x1 l=getfenv and getfenv();end elseif e%2~=0 then e=(e*0x24b)%0x4ed9 local e=45890 if not f[e]then f[e]=0x1 a={};end else e=(e*0x3c0)%0xa6b9 n=n+1 local e=74204 if not f[e]then f[e]=0x1 l=(not l)and _ENV or l;end end end else e=(e*0x205)%0x44f9 n=n+1 while n<0x1e2 and e%0x264a<0x1325 do n=n+1 e=(e-372)%34989 local b=n+e if(e%0x4d04)<0x2682 then e=(e+0x380)%0x599e local e=49572 if not f[e]then f[e]=0x1 r="\4\8\116\111\110\117\109\98\101\114\114\104\120\116\114\85\113\66\0\6\115\116\114\105\110\103\4\99\104\97\114\112\88\109\112\84\72\80\116\0\6\115\116\114\105\110\103\3\115\117\98\73\81\95\95\121\120\68\118\0\6\115\116\114\105\110\103\4\98\121\116\101\70\66\120\79\116\67\102\73\0\5\116\97\98\108\101\6\99\111\110\99\97\116\74\120\95\122\72\118\88\80\0\5\116\97\98\108\101\6\105\110\115\101\114\116\72\117\119\88\115\115\100\103\5";end elseif e%2~=0 then e=(e+0x310)%0x6fe4 local e=49568 if not f[e]then f[e]=0x1 end else e=(e*0x209)%0x72 n=n+1 local e=78165 if not f[e]then f[e]=0x1 t=function(t)local e=0x01 local function f(n)e=e+n return t:sub(e-n,e-0x01)end while true do local n=f(0x01)if(n=="\5")then break end local e=d.byte(f(0x01))local e=f(e)if n=="\2"then e=a.rhxtrUqB(e)elseif n=="\3"then e=e~="\0"elseif n=="\6"then l[e]=function(e,n)return o(8,nil,o,n,e)end elseif n=="\4"then e=l[e]elseif n=="\0"then e=l[e][f(d.byte(f(0x01)))];end local n=f(0x08)a[n]=e end end end end end end end e=(e*237)%27299 end t(r);local n={};for e=0x0,0xff do local f=a.pXmpTHPt(e);n[e]=f;n[f]=e;end local function b(e)return n[e];end local d=(function(o,d)local r,f=0x01,0x10 local n={{},{},{}}local l=-0x01 local e=0x01 local t=o while true do n[0x03][a.IQ__yxDv(d,e,(function()e=r+e return e-0x01 end)())]=(function()l=l+0x01 return l end)()if l==(0x0f)then l=""f=0x000 break end end local l=#d while e<l+0x01 do n[0x02][f]=a.IQ__yxDv(d,e,(function()e=r+e return e-0x01 end)())f=f+0x01 if f%0x02==0x00 then f=0x00 a.HuwXssdg(n[0x01],(b((((n[0x03][n[0x02][0x00]]or 0x00)*0x10)+(n[0x03][n[0x02][0x01]]or 0x00)+t)%0x100)));t=o+t;end end return a.Jx_zHvXP(n[0x01])end);t(d(60,"sl3wL7<jnoIS0;rN0o"));t(d(192,"4>BCRLSfi3c9Zn?7RziSCCfR9B?3B?SfRR?RCLSn9M7jBZfBiBn7CRR7ifiRZLf6cC?>BZSZ9BncBRRR3i7R>3f3R>iLCOfBc3??CRf;c>?cCQRS3BnBBS*6RS7CCRfBc3??BfeLcn?>CRSCciZcD>fB37?ZPZRi33i_ZRSnc>7RBidLcZ?RBLfi95n}C>RZ3L?9BBfccCiRZZfCcL7RBnSL9R?>CRS>cB?ZBLR>cf7oB3LB9>Z>>SgRRfnSBLSC9R?7CBCCii?cB3R>iL??B9R7RRiRCfS>c37RGZLCc9nBB?RB9BncZBD>f3?fyRSncSn>>BLf9HiRZifRc77CCRfBc3??BffS9,ZBwiR>iR?C>cuWRL7RB>SBcZ?LZSfLc?7*B>SCc9nLC3Sf9f?ZCcf>3iiRZSfLc?72B>SCc9nCBLfLcn7SD3R>9CiRZLfI9B?3B?fRiLn7BBRS3SZ9B>fFRRiSCCSLcZ?LBCfRc>?c>iRCi77cBSLcRXiRBnS>9R?iZLSScZ?7B7fB3R7>C>S99fZL>>S7RL"));local e=(-7657+(function()local l,e=0,1;(function(e,n)e(n(e,e),e(n,e))end)(function(n,f)if l>373 then return n end l=l+1 e=(e+574)%11123 if(e%732)<366 then e=(e-897)%36497 return n(f(f and n,f),n(n,f))else return f end return n end,function(n,f)if l>119 then return f end l=l+1 e=(e-628)%28965 if(e%1942)>971 then e=(e-549)%35368 return n(f(n,n)and f(n,f),f(f and f,n))else return n end return n end)return e;end)())local b=a.SeumvIAs or a.UygwlzqX;local fe=(getfenv)or(function()return _ENV end);local t=3;local p=1;local l=2;local r=4;local function ne(s,...)local j=d(e,"Uf4 bH6?*g7xjAvD6xg7v? b*4v?fx6*xHbDxv:xH?*gv*  ?jxA4x?6x7ZjH47xjA x* AGfv?bgbfb6f7j**Ax4f6vxxH*jf# 6*7fDxbg4b?bxAG7H?D4H47xDqAg4D?4xDzj7d_x6?g D4bjgAAA4b? HjxfDHb4*D4jgHA? j?HjDDf6j7Ag4vf4x?*jH*<jb4 D7Hmg v+4AjA x?HA 446mx7AjH?g*?AAff66 x5b6x*W7H*g4vj4v?A66x*DDbjggbD7 vf 6*jA7xHdjbvgxv**fDf 4?AAHQ66Dxff6bD7g*HA7fv6xx*b7xDTv6KgvDgfx?Hxfxx_vHb7fvv?vD?b gEAbfD?AH?j7D) A*74x*jA7 f4xxvSvHv7b7jHE*?v6va?Ajjf66*76DfbD*AAgv4*6jHfAHv6 AAbjggvHf??6jfjxbv?*g vb4j?gj6Hgjjfj6Ax7gHvb4v?xj*6*jx4 DAH g6v  aA4 *?jAH466?xxL*b7g6*pA7fg66x H4x4oxHjgAD   *vxXf6?Xx Z*bv ?*?AnfA67Ox? j1z7vjbb*HA4fDj f76Dj?v6Hj7jj7 j*7A7fDugHg74vD jD# ?gYAHxvf0H?7bDf*vvjb7*7vr  mAHj76D b>v? DgH?Hjg-vHx7* 7x MbbHggv64*?bHv7DD?bbgf4jgbv64D? 6hxgDgb6g  DgvvA x66xHDgHH74}7bj*Hvbj7fx6 xlDA*A: H 7bv jj4g6Hx4DDgg#*Hx76vH8D*DAx4*?Oxjjj4x7fvx 4*?67xj} H3gA4D7bD bH* AvxghAH4gDvj?xv? 6*xAAfx67xD7fvv*x**AH446DD*tgH67 Df A*7A? 6*bxv0xH*76D4 D*jvx4x? jrSA? 7?Dbbfxbvf4*?Hj4fHHj77D6HlgFvf6f??jbff6b7xDgbHg49*4j?gj6fb657AD7HgxDvf4v?xAjfH647DfjHbg6v  o?Aj7fx6bj sgbxg7vH b?Djjfg66xj%mbAg7vg b* jv x?}xH3 bDgjvgb8* DqfD67xgObH4gv:* *7HvAfD6DxgK?H x vAbj7_Ab466vj2{*HH74vDbf*gAg4 ?HxA^jH?x64  v*DA* g?4xD^j?g7?D bb*AAv4??*jf42??7*Dxb4g6Aj4g?6j 4AHA7vD?b7gfvR4x?vj?f46b7jDvb6gbvk4v?7j?bf6f7vDxbggHv44D*4jxf66gxkDDb7g*vb 4?vjxbH6Hx4DDHaggv6  g4jvf76vxbJgbvgxv*HHgAjD4 6gxAe H6gADjbv*bAgfv?Ax*!HH4gDDD g*AA 446Axja?*b7*vvb4**A*44*xxjfgHx7 D? AgDA?46?fvvfiH*7jD4H_*jD?46g Da3A647?Dxbf7HAxb*gbj4f?HjxfD6bDgsv 4j??jvffHv7xDgbHgHAD4j76j6f 6ox4D7b?gbvfHx?xj*fH6H7DDjbgg6fE 3?Aj7fA6bxfDvbxj?vH 7?DA6fg6?x 4sbDg7vD b**jv4x6*AHf?bD7bvg v* AjfA?_xgGbHxgvvD **6A44f6jxg  H 7>vA A*?Ab4f6vv*#*HH74DH j*gA64 g xAf4H?7vDf D*xD* v?4j?;jHj76i6b{gDv74??vjffgHx7*DHb4gxAj f?6jAf/HD77f?H6gfv?4x*FjH4HHDxvPjb6gvvcbg?7j?fb6fx4DxHfgHvA4D?vjg 6*4xcl?b77kvbbb?vAAH66HxvDD66ggv6  *hv f7?fxbWAbvgAv*HHgbjD4?6gjG( 6xgAa7H4*bAjfv?6x*ffH47Hvv gg A 4 6Axx=?H67fvv6***AH44?Hxj+gH67 fA A*7A?4A?fxvBxH*xDD4b7*jv646?bjy2A?37?DDbfg4Ax4*?HAb4?HjxHD6H4gNAA47*gj7ff6x7xfubHg4AD vgHj64f6%j D7b?gbD  A?xA?fH?57DDjbgg6Dj u**j7466bx4DvHAj vH v?DAHfg66x %wHDg7Db b*jjvfx6*xHfDbD7*vg ** AvfA6vxDVbHfgv * **6A4 D*xxgf?H 7gvAbA*?AbH76vjv^*6H74vD j*gv*4 *fxAfAH?76DfHvgxA* ??4Aytj?b76f H7*Avj4?*6jff7Hx7vD?b47 Aj47?6jbf)HD77D??fgfAv4x?vjHf4HD7j46b6g ve 6?7j?fb6fx7DxH7gHD64D?Ajgfj?jxT3gb7Axvb 4?vjAf*6gvgDDbjgg47  *fjAf7gnxbLfbvgjv* H*4AHfj6gx6,6HXgAv7 **AAffv6xDA?4jff Hf7jjv4*6b6vj6m?Hb7fbHgjDfbg6*Av4vbjxv:jHj7f*xAA4b?fxvH,jHfb667bDDvg46? jS3A6A7?Dbbf*vAx4*?Hj4b Hj7gD6bbgCAD47?ADvffHv7x+?bHg AD4j?gj7b76E7AD7H6gbv44v?xAxfH647DDAbgg6v H9*fj7f?6bxfDvbAg*D? b?Djvfg6?x oJbAg7D6 b*fjvfA6*x?246Dgvvg ?* AmfA6jx?f6HDgvvv ***A4fD6jxg}7H 7fvA A*?A64f6vjx_*H?74Df j*gA64 *HxAaAH?7HDf v*xA*4D?4j 1jH776D be*Av64??6jff4Hx7gDHb4x*Aj4g?6jbf^HA77D?bbgfAv4x?*jHf4HDxfDgb6g vQ +?7j?fb6f7vDxb*gHvb4D?Ajgf?6 xpDAb77?vb  ?vjxf*6Hx4DD6Mggv6  *4jAfx6?xbfAbvgxv* 6*4jDfj6gx6P H9gAvD ?*bAffD?4x*qHH4DHHH7jvD H*jA4xxSxHb7fvv*RD6b7*D?cjbkgH67  4gvvAb4gbA44f?6Hgx6D4 D*j4j*xv?I ?jjjpj xx6D?4Mg6A64b?xjfJAD?bvgBAA47x7  * j D46A7vv6H*gjAvjDf 687A_7HAgbvf4v?jj*f6647DDDbgg*v  Z?Aj7f?*bxDDvbAg*v? 4* jj4x?gx _bbAgjv? b*fvv4D6*xgR4H gjvv 67 A7fA6vx?R*Hf7fvx **xA44b6jx7c6H 71vAb6*?A64f? xxEgHH74f* j*gA64b?yxAe7H?7bDf v*AA*4H?4xDffHg76D b/g<A74??bjfhvHx7*DHb?*DAA4g??j feHA772Dbbg Av4x?*jHf4HDj Dgb6g v44A?xj?fb6g7vDxb*g6v44D?jjgf66 xoDAbAg?vb f?DA?f*6Hx4H67A&4H7?gvD DHAjDfA6Ax4gjvv H*4jD6fA64H??xHfFvxb-*bAffvxr4H?bj6hbHD*fAxf?4j6Ax7T?Hbxfvv x**AH446Dxj4g667 DO A*7A?4H?fA<42H*7?D4b4*jAg46? A4aAH77?D6bfg5Axb***j4f=Hj7gD6bbg^vD  ??j?ff6a7xD*bHg4Dz4j?7j6f66)7DD7b?jgvf i?xjgfH647DDjH4g6v6 &?vj7f?6bxffbbxgjvH 4?Djjfg66j?ZWbDg7vx b*4jvfx?jxHE4bDgAvg 6* AsfA67x?.bH?gvvx **6A7fD6jxgbvj*WAbv7*D6 A*H6Djxi*HH74 ?xfD6 ?gfAD466v7gf 6kx4Ax gg?v6jzf.Hg76D **D4 x*x?HA6avHx7* x7xDAbV6DAD H* AfvAHD7ADAb4?7Avr*?vjofD6jb?gjvo4A?7k7?jj44THj7xwgb?7f?AA?f66 xMb x LHb*??v? A*xAgDH6?xH/Hb7HH*kjAf76Ajfqfbvgxvx H* jDfA6gx7 7H&gAv7 7*bA4fv6xjxQHH4gDvj g*6A 467?x7w?Hbjdvv j**AH44? D ygH67 MD A*xA?bb7fxv-AH*7HD4bb*jAD6(? j4,A?g7?DHbf*vAx4j7jj4!DHjj*D6bbgPDAH7??j6ffHv7xDAbHx4K64j?xj6fH6XxfD7Hg7xvf 4?xjgfH647DDjH7g6vH /*fj7fg6bAfI4bxgxvH 4?DAffg*6x6CYH<g7v7 b*?jv4A?1xHw?bDgvvg 6* AJfD67x7XbH6gvvA **xmjfD6AxgfvH 7fvA 7*?A*H*6vxxt*6A74D= j7gZ64 ?bxAI7H?7gDfHv77A*4g?4j -jHD76oHHx*Ave4???jfMvHx7*D7b4g Aj4D?6jHf:6 x?D?b*gfD?4x?gjHf HDxz sb6g vVb6?7j*fb6fx*DxbjgHv 4D?jjgfj6xx#)4b7xHvb 4?vjAf*6gvgDDbjggwb  *fjA416DxbF6bvxgv* 6*4A4fj6AvAY HrgAn* ?*HAffv*<x*V7H47 vj g*6A 6 6AxDN?H67fvv x**AD44?fxjSgH67 DY AjAA?46?fj:IxH*7HD46**jAg46?bjoFAH77?Dbbf*vAA4*");local n=0;a.rZdDXtYy(function()a.LSkRnBrZ()n=n+1 end)local function e(f,e)if e then return n end;n=f+n;end local f,n,h=o(0,o,e,j,a.FBxOtCfI);local function d()local f,n=a.FBxOtCfI(j,e(1,3),e(5,6)+2);e(2);return(n*256)+f;end;local g=true;local g=0 local function k()local e=n();local n=n();local t=1;local l=(f(n,1,20)*(2^32))+e;local e=f(n,21,31);local n=((-1)^f(n,32));if(e==0)then if(l==g)then return n*0;else e=1;t=0;end;elseif(e==2047)then return(l==0)and(n*(1/0))or(n*(0/0));end;return a.PqLUkbzc(n,e-1023)*(t+(l/(2^52)));end;local u=n;local function _(n)local f;if(not n)then n=u();if(n==0)then return'';end;end;f=a.IQ__yxDv(j,e(1,3),e(5,6)+n-1);e(n)local e=""for n=(1+g),#f do e=e..a.IQ__yxDv(f,n,n)end return e;end;local u=#a.vpBHADcZ(c('\49.\48'))~=1 local e=n;local function ne(...)return{...},a.ajXCOzfZ('#',...)end local function ee()local g={};local e={};local c={};local j={c,g,nil,e};local e=n()local b={}for l=1,e do local f=h();local n;if(f==0)then n=(h()~=#{});elseif(f==2)then local e=k();if u and a.JAr_lLHY(a.vpBHADcZ(e),'.(\48+)$')then e=a.TqqkwEQo(e);end n=e;elseif(f==1)then n=_();end;b[l]=n;end;for j=1,n()do local e=h();if(f(e,1,1)==0)then local o=f(e,2,3);local a=f(e,4,6);local e={d(),d(),nil,nil};if(o==0)then e[t]=d();e[r]=d();elseif(o==#{1})then e[t]=n();elseif(o==s[2])then e[t]=n()-(2^16)elseif(o==s[3])then e[t]=n()-(2^16)e[r]=d();end;if(f(a,1,1)==1)then e[l]=b[e[l]]end if(f(a,2,2)==1)then e[t]=b[e[t]]end if(f(a,3,3)==1)then e[r]=b[e[r]]end c[j]=e;end end;for e=1,n()do g[e-(#{1})]=ee();end;j[3]=h();return j;end;local function z(f,n,e)local l=n;local l=e;return c(a.JAr_lLHY(a.JAr_lLHY(({a.rZdDXtYy(f)})[2],n),e))end local function k(u,h,c)local function z(...)local d,_,g,ee,fe,f,z,m,s,y,j,n;local e=0;while-1<e do if e>=3 then if 4>=e then if-1<e then for n=30,88 do if e>3 then y=a.ajXCOzfZ('#',...)-1;j={};break;end;m={};s={...};break;end;else m={};s={...};end else if e~=6 then n=o(7);else e=-2;end end else if 0<e then if e~=2 then g=o(6,78,3,30,u);fe=ne ee=0;else f=-41;z=-1;end else d=o(6,96,1,96,u);_=o(6,29,2,99,u);end end e=e+1;end;for e=0,y do if(e>=g)then m[e-g]=s[e+1];else n[e]=s[e+1];end;end;local e=y-g+1 local e;local o;local function g(...)while true do end end while true do if f<-40 then f=f+42 end e=d[f];o=e[p];if 34<o then if 52>=o then if o<=43 then if o>=39 then if 40<o then if 41>=o then do return end;else if 38<o then repeat if 42~=o then n[e[l]]=c[e[t]];break;end;local l=e[l]local t={n[l](n[l+1])};local f=0;for e=l,e[r]do f=f+1;n[e]=t[f];end until true;else local f=e[l]local t={n[f](n[f+1])};local l=0;for e=f,e[r]do l=l+1;n[e]=t[l];end end end else if o~=35 then for a=12,84 do if o<40 then local o,h;for a=0,6 do if a>=3 then if a>4 then if 1~=a then repeat if a<6 then n(e[l],e[t]);f=f+1;e=d[f];break;end;o=e[l]n[o]=n[o](b(n,o+1,e[t]))until true;else n(e[l],e[t]);f=f+1;e=d[f];end else if 1<a then for b=36,54 do if 4>a then n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];break;end;o=e[l];h=n[e[t]];n[o+1]=h;n[o]=h[e[r]];f=f+1;e=d[f];break;end;else n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];end end else if a<1 then o=e[l];h=n[e[t]];n[o+1]=h;n[o]=h[e[r]];f=f+1;e=d[f];else if 2~=a then n(e[l],e[t]);f=f+1;e=d[f];else o=e[l]n[o]=n[o](b(n,o+1,e[t]))f=f+1;e=d[f];end end end end break;end;n[e[l]]=h[e[t]];break;end;else n[e[l]]=h[e[t]];end end else if 37>o then if 32~=o then for a=27,65 do if o<36 then local o,a;for h=0,6 do if h<=2 then if h<=0 then o=e[l]n[o](b(n,o+1,e[t]))f=f+1;e=d[f];else if h>=-1 then repeat if h~=2 then o=e[l];a=n[e[t]];n[o+1]=a;n[o]=a[e[r]];f=f+1;e=d[f];break;end;n(e[l],e[t]);f=f+1;e=d[f];until true;else o=e[l];a=n[e[t]];n[o+1]=a;n[o]=a[e[r]];f=f+1;e=d[f];end end else if h<5 then if h>1 then repeat if 3<h then o=e[l];a=n[e[t]];n[o+1]=a;n[o]=a[e[r]];f=f+1;e=d[f];break;end;o=e[l]n[o]=n[o](b(n,o+1,e[t]))f=f+1;e=d[f];until true;else o=e[l];a=n[e[t]];n[o+1]=a;n[o]=a[e[r]];f=f+1;e=d[f];end else if h>=4 then for r=45,61 do if 6~=h then n(e[l],e[t]);f=f+1;e=d[f];break;end;o=e[l]n[o]=n[o](b(n,o+1,e[t]))break;end;else o=e[l]n[o]=n[o](b(n,o+1,e[t]))end end end end break;end;n[e[l]]={};break;end;else n[e[l]]={};end else if 33~=o then repeat if 38>o then n[e[l]]=n[e[t]][e[r]];break;end;if(n[e[l]]~=e[r])then f=f+1;else f=e[t];end;until true;else n[e[l]]=n[e[t]][e[r]];end end end else if o<=47 then if 46<=o then if 46~=o then local o,a;for h=0,2 do if 0<h then if-3~=h then for b=41,84 do if h~=1 then o=e[l];a=n[e[t]];n[o+1]=a;n[o]=a[e[r]];break;end;n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];break;end;else n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];end else o=e[l]n[o](b(n,o+1,e[t]))f=f+1;e=d[f];end end else c[e[t]]=n[e[l]];end else if o~=43 then repeat if 45~=o then if(n[e[l]]~=e[r])then f=f+1;else f=e[t];end;break;end;n[e[l]]=n[e[t]];until true;else if(n[e[l]]~=e[r])then f=f+1;else f=e[t];end;end end else if 49>=o then if o~=48 then local f=e[l];local l=n[f];for e=f+1,e[t]do a.HuwXssdg(l,n[e])end;else n[e[l]]=n[e[t]][e[r]];end else if 50<o then if 51==o then local l=e[l];local f=n[e[t]];n[l+1]=f;n[l]=f[e[r]];else local e=e[l]n[e]=n[e]()end else local o,h;for a=0,3 do if a>1 then if a==2 then n(e[l],e[t]);f=f+1;e=d[f];else o=e[l]n[o]=n[o](b(n,o+1,e[t]))end else if a>=-4 then for b=45,85 do if a~=1 then n[e[l]]=c[e[t]];f=f+1;e=d[f];break;end;o=e[l];h=n[e[t]];n[o+1]=h;n[o]=h[e[r]];f=f+1;e=d[f];break;end;else n[e[l]]=c[e[t]];f=f+1;e=d[f];end end end end end end end else if 62>o then if 57<=o then if o<59 then if 56~=o then repeat if o<58 then local o,h;for a=0,3 do if a<2 then if-4~=a then repeat if a~=0 then o=e[l]n[o]=n[o](b(n,o+1,e[t]))f=f+1;e=d[f];break;end;n[e[l]]=n[e[t]];f=f+1;e=d[f];until true;else o=e[l]n[o]=n[o](b(n,o+1,e[t]))f=f+1;e=d[f];end else if a~=1 then repeat if 2<a then o=e[l];h=n[e[t]];n[o+1]=h;n[o]=h[e[r]];break;end;n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];until true;else n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];end end end break;end;if n[e[l]]then f=f+1;else f=e[t];end;until true;else local o,h;for a=0,3 do if a<2 then if-4~=a then repeat if a~=0 then o=e[l]n[o]=n[o](b(n,o+1,e[t]))f=f+1;e=d[f];break;end;n[e[l]]=n[e[t]];f=f+1;e=d[f];until true;else o=e[l]n[o]=n[o](b(n,o+1,e[t]))f=f+1;e=d[f];end else if a~=1 then repeat if 2<a then o=e[l];h=n[e[t]];n[o+1]=h;n[o]=h[e[r]];break;end;n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];until true;else n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];end end end end else if 59<o then if o>60 then local d=n[e[r]];if d then f=f+1;else n[e[l]]=d;f=e[t];end;else for o=0,3 do if 2<=o then if 0<=o then repeat if 2<o then if(n[e[l]]~=e[r])then f=f+1;else f=e[t];end;break;end;n[e[l]]=c[e[t]];f=f+1;e=d[f];until true;else if(n[e[l]]~=e[r])then f=f+1;else f=e[t];end;end else if o~=-2 then repeat if 1>o then n[e[l]]=(e[t]~=0);f=f+1;e=d[f];break;end;c[e[t]]=n[e[l]];f=f+1;e=d[f];until true;else n[e[l]]=(e[t]~=0);f=f+1;e=d[f];end end end end else do return n[e[l]]end end end else if 54>=o then if 50<=o then repeat if o~=53 then n[e[l]][e[t]]=e[r];break;end;local o;n[e[l]]=h[e[t]];f=f+1;e=d[f];n[e[l]]=n[e[t]];f=f+1;e=d[f];n[e[l]]=(e[t]~=0);f=f+1;e=d[f];o=e[l]n[o](b(n,o+1,e[t]))f=f+1;e=d[f];do return end;until true;else n[e[l]][e[t]]=e[r];end else if 51<=o then repeat if o~=56 then f=e[t];break;end;local d,b,o,r,a;local f=0;while f>-1 do if f>=3 then if f>4 then if f==5 then n(a,r);else f=-2;end else if 1<=f then repeat if f<4 then r=d[o];break;end;a=d[b];until true;else r=d[o];end end else if 0<f then if 1<f then o=t;else b=l;end else d=e;end end f=f+1 end until true;else local d,a,o,r,b;local f=0;while f>-1 do if f>=3 then if f>4 then if f==5 then n(b,r);else f=-2;end else if 1<=f then repeat if f<4 then r=d[o];break;end;b=d[a];until true;else r=d[o];end end else if 0<f then if 1<f then o=t;else a=l;end else d=e;end end f=f+1 end end end end else if 66<=o then if 67>=o then if 64<o then repeat if 66~=o then do return n[e[l]]end break;end;c[e[t]]=n[e[l]];until true;else do return n[e[l]]end end else if 69<=o then if 67~=o then for f=34,92 do if o<70 then n[e[l]]=(e[t]~=0);break;end;local f=e[l]n[f](b(n,f+1,e[t]))break;end;else n[e[l]]=(e[t]~=0);end else local o;n[e[l]]=h[e[t]];f=f+1;e=d[f];n[e[l]]=h[e[t]];f=f+1;e=d[f];n[e[l]]=(e[t]~=0);f=f+1;e=d[f];o=e[l]n[o](b(n,o+1,e[t]))f=f+1;e=d[f];do return end;end end else if o<64 then if 61~=o then for a=32,57 do if 62~=o then n[e[l]]=(not n[e[t]]);break;end;local c,h,j,g,s,o,a,u;for o=0,3 do if o<2 then if o>-1 then for r=31,61 do if 0<o then a=e[l]n[a]=n[a](b(n,a+1,e[t]))f=f+1;e=d[f];break;end;o=0;while o>-1 do if o<=2 then if o<1 then c=e;else if o>-3 then for e=18,83 do if 1<o then j=t;break;end;h=l;break;end;else h=l;end end else if o>=5 then if 2<o then for e=33,66 do if o~=6 then n(s,g);break;end;o=-2;break;end;else o=-2;end else if 4==o then s=c[h];else g=c[j];end end end o=o+1 end f=f+1;e=d[f];break;end;else o=0;while o>-1 do if o<=2 then if o<1 then c=e;else if o>-3 then for e=18,83 do if 1<o then j=t;break;end;h=l;break;end;else h=l;end end else if o>=5 then if 2<o then for e=33,66 do if o~=6 then n(s,g);break;end;o=-2;break;end;else o=-2;end else if 4==o then s=c[h];else g=c[j];end end end o=o+1 end f=f+1;e=d[f];end else if-2<=o then repeat if 2<o then a=e[l];u=n[e[t]];n[a+1]=u;n[a]=u[e[r]];break;end;n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];until true;else n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];end end end break;end;else n[e[l]]=(not n[e[t]]);end else if 60~=o then repeat if o<65 then local l=e[l];local o=e[r];local d=l+2 local l={n[l](n[l+1],n[d])};for e=1,o do n[d+e]=l[e];end;local l=l[1]if l then n[d]=l f=e[t];else f=f+1;end;break;end;local g=_[e[t]];local b;local o={};b=a.AgpiRqAV({},{__index=function(n,e)local e=o[e];return e[1][e[2]];end,__newindex=function(f,e,n)local e=o[e]e[1][e[2]]=n;end;});for l=1,e[r]do f=f+1;local e=d[f];if e[p]==45 then o[l-1]={n,e[t]};else o[l-1]={h,e[t]};end;j[#j+1]=o;end;n[e[l]]=k(g,b,c);until true;else local l=e[l];local o=e[r];local d=l+2 local l={n[l](n[l+1],n[d])};for e=1,o do n[d+e]=l[e];end;local l=l[1]if l then n[d]=l f=e[t];else f=f+1;end;end end end end end else if o<17 then if o<=7 then if 4>o then if o>1 then if 2<o then local o;n[e[l]]=h[e[t]];f=f+1;e=d[f];n[e[l]]=h[e[t]];f=f+1;e=d[f];n[e[l]]=(e[t]~=0);f=f+1;e=d[f];o=e[l]n[o](b(n,o+1,e[t]))f=f+1;e=d[f];do return end;else local g=_[e[t]];local b;local o={};b=a.AgpiRqAV({},{__index=function(n,e)local e=o[e];return e[1][e[2]];end,__newindex=function(f,e,n)local e=o[e]e[1][e[2]]=n;end;});for l=1,e[r]do f=f+1;local e=d[f];if e[p]==45 then o[l-1]={n,e[t]};else o[l-1]={h,e[t]};end;j[#j+1]=o;end;n[e[l]]=k(g,b,c);end else if o~=0 then local o;n[e[l]]=c[e[t]];f=f+1;e=d[f];n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];n(e[l],e[t]);f=f+1;e=d[f];o=e[l]n[o]=n[o](n[o+1])f=f+1;e=d[f];n[e[l]][e[t]]=e[r];f=f+1;e=d[f];n[e[l]][e[t]]=n[e[r]];f=f+1;e=d[f];n[e[l]][e[t]]=e[r];else n[e[l]]={};end end else if 6<=o then if o~=4 then repeat if o~=6 then local e=e[l]n[e]=n[e](n[e+1])break;end;local f=e[l]local t={n[f](n[f+1])};local l=0;for e=f,e[r]do l=l+1;n[e]=t[l];end until true;else local e=e[l]n[e]=n[e](n[e+1])end else if o>0 then for a=40,68 do if 5~=o then local o,c,j,g,u,s,k,a;o=e[l];c=n[e[t]];n[o+1]=c;n[o]=c[e[r]];f=f+1;e=d[f];a=0;while a>-1 do if a<=2 then if 0<a then if a>1 then u=t;else g=l;end else j=e;end else if 4<a then if 4<=a then for e=26,82 do if a<6 then n(k,s);break;end;a=-2;break;end;else a=-2;end else if a~=3 then k=j[g];else s=j[u];end end end a=a+1 end f=f+1;e=d[f];o=e[l]n[o]=n[o](b(n,o+1,e[t]))f=f+1;e=d[f];o=e[l];c=n[e[t]];n[o+1]=c;n[o]=c[e[r]];f=f+1;e=d[f];n(e[l],e[t]);f=f+1;e=d[f];o=e[l]n[o]=n[o](b(n,o+1,e[t]))f=f+1;e=d[f];n[e[l]]=h[e[t]];break;end;local f=e[l]n[f]=n[f](b(n,f+1,e[t]))break;end;else local f=e[l]n[f]=n[f](b(n,f+1,e[t]))end end end else if 11<o then if o>=14 then if o<15 then do return end;else if o~=13 then repeat if 15<o then local o,a;n[e[l]]=h[e[t]];f=f+1;e=d[f];o=e[l];a=n[e[t]];n[o+1]=a;n[o]=a[e[r]];f=f+1;e=d[f];n(e[l],e[t]);f=f+1;e=d[f];o=e[l]n[o]=n[o](b(n,o+1,e[t]))f=f+1;e=d[f];o=e[l];a=n[e[t]];n[o+1]=a;n[o]=a[e[r]];f=f+1;e=d[f];n(e[l],e[t]);f=f+1;e=d[f];o=e[l]n[o]=n[o](b(n,o+1,e[t]))break;end;local e=e[l]n[e]=n[e](n[e+1])until true;else local o,a;n[e[l]]=h[e[t]];f=f+1;e=d[f];o=e[l];a=n[e[t]];n[o+1]=a;n[o]=a[e[r]];f=f+1;e=d[f];n(e[l],e[t]);f=f+1;e=d[f];o=e[l]n[o]=n[o](b(n,o+1,e[t]))f=f+1;e=d[f];o=e[l];a=n[e[t]];n[o+1]=a;n[o]=a[e[r]];f=f+1;e=d[f];n(e[l],e[t]);f=f+1;e=d[f];o=e[l]n[o]=n[o](b(n,o+1,e[t]))end end else if o>8 then repeat if o~=13 then local f=e[l]n[f](b(n,f+1,e[t]))break;end;if not n[e[l]]then f=f+1;else f=e[t];end;until true;else local f=e[l]n[f](b(n,f+1,e[t]))end end else if o>9 then if 10~=o then local o,a;o=e[l];a=n[e[t]];n[o+1]=a;n[o]=a[e[r]];f=f+1;e=d[f];n(e[l],e[t]);f=f+1;e=d[f];o=e[l]n[o]=n[o](b(n,o+1,e[t]))f=f+1;e=d[f];n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];o=e[l];a=n[e[t]];n[o+1]=a;n[o]=a[e[r]];f=f+1;e=d[f];n(e[l],e[t]);else n[e[l]]=(e[t]~=0);end else if 6~=o then repeat if 9>o then local d=n[e[r]];if d then f=f+1;else n[e[l]]=d;f=e[t];end;break;end;n[e[l]][e[t]]=e[r];until true;else n[e[l]][e[t]]=e[r];end end end end else if 26<=o then if o<30 then if o<28 then if o>23 then repeat if o<27 then local o,r;o=e[l]n[o](b(n,o+1,e[t]))f=f+1;e=d[f];n[e[l]]={};f=f+1;e=d[f];n(e[l],e[t]);f=f+1;e=d[f];n(e[l],e[t]);f=f+1;e=d[f];n(e[l],e[t]);f=f+1;e=d[f];n(e[l],e[t]);f=f+1;e=d[f];o=e[l];r=n[o];for e=o+1,e[t]do a.HuwXssdg(r,n[e])end;break;end;local o,b,d,r,a;local f=0;while f>-1 do if 2>=f then if f<=0 then o=e;else if f~=-2 then repeat if 2~=f then b=l;break;end;d=t;until true;else d=t;end end else if f<5 then if 1<f then repeat if 4>f then r=o[d];break;end;a=o[b];until true;else r=o[d];end else if f~=5 then f=-2;else n(a,r);end end end f=f+1 end until true;else local d,a,o,r,b;local f=0;while f>-1 do if 2>=f then if f<=0 then d=e;else if f~=-2 then repeat if 2~=f then a=l;break;end;o=t;until true;else o=t;end end else if f<5 then if 1<f then repeat if 4>f then r=d[o];break;end;b=d[a];until true;else r=d[o];end else if f~=5 then f=-2;else n(b,r);end end end f=f+1 end end else if 28<o then f=e[t];else local f=e[l]n[f]=n[f](b(n,f+1,e[t]))end end else if o>31 then if o>=33 then if 29~=o then for f=16,91 do if o~=33 then local f=e[l];local l=n[f];for e=f+1,e[t]do a.HuwXssdg(l,n[e])end;break;end;n[e[l]][e[t]]=n[e[r]];break;end;else local f=e[l];local l=n[f];for e=f+1,e[t]do a.HuwXssdg(l,n[e])end;end else n[e[l]]=c[e[t]];end else if 26<o then repeat if o~=30 then local l=e[l];local f=n[e[t]];n[l+1]=f;n[l]=f[e[r]];break;end;n[e[l]][e[t]]=n[e[r]];until true;else n[e[l]][e[t]]=n[e[r]];end end end else if o<=20 then if o>18 then if o<20 then n[e[l]]=h[e[t]];else if not n[e[l]]then f=f+1;else f=e[t];end;end else if o>17 then local a,b,o;for h=0,2 do if 1>h then n[e[l]]=n[e[t]];f=f+1;e=d[f];else if h==1 then a=e[l]b={n[a](n[a+1])};o=0;for e=a,e[r]do o=o+1;n[e]=b[o];end f=f+1;e=d[f];else f=e[t];end end end else local e=e[l]n[e]=n[e]()end end else if 22<o then if 23<o then if 23~=o then for d=28,63 do if o~=25 then if n[e[l]]then f=f+1;else f=e[t];end;break;end;local d=e[l];local o=e[r];local l=d+2 local d={n[d](n[d+1],n[l])};for e=1,o do n[l+e]=d[e];end;local d=d[1]if d then n[l]=d f=e[t];else f=f+1;end;break;end;else if n[e[l]]then f=f+1;else f=e[t];end;end else n[e[l]]=(not n[e[t]]);end else if o>19 then repeat if 21~=o then local o,a;n[e[l]][e[t]]=n[e[r]];f=f+1;e=d[f];n[e[l]]=h[e[t]];f=f+1;e=d[f];o=e[l];a=n[e[t]];n[o+1]=a;n[o]=a[e[r]];f=f+1;e=d[f];n[e[l]]=c[e[t]];f=f+1;e=d[f];n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];n[e[l]]=n[e[t]][e[r]];f=f+1;e=d[f];n[e[l]]=(not n[e[t]]);break;end;local d,r,h,o,b,a;local f=0;while f>-1 do if f>3 then if f>=6 then if f>=5 then for e=46,63 do if 7~=f then n[a]=b;break;end;f=-2;break;end;else f=-2;end else if f~=0 then repeat if 4<f then a=d[r];break;end;b=o[d[h]];until true;else a=d[r];end end else if f>1 then if-2<=f then for e=29,53 do if f~=2 then o=n;break;end;h=t;break;end;else o=n;end else if f~=0 then r=l;else d=e;end end end f=f+1 end until true;else local d,r,h,o,b,a;local f=0;while f>-1 do if f>3 then if f>=6 then if f>=5 then for e=46,63 do if 7~=f then n[a]=b;break;end;f=-2;break;end;else f=-2;end else if f~=0 then repeat if 4<f then a=d[r];break;end;b=o[d[h]];until true;else a=d[r];end end else if f>1 then if-2<=f then for e=29,53 do if f~=2 then o=n;break;end;h=t;break;end;else o=n;end else if f~=0 then r=l;else d=e;end end end f=f+1 end end end end end end end f=1+f;end;end;return z end;local l=0xff;local h={};local d=(1);local t='';(function(n)local f=n local o=0x00 local e=0x00 f={(function(r)if o>0x23 then return r end o=o+1 e=(e+0x9bb-r)%0x22 return(e%0x03==0x2 and(function(f)if not n[f]then e=e+0x01 n[f]=(0x3c);end return true end)'cZYPq'and f[0x2](0x290+r))or(e%0x03==0x0 and(function(f)if not n[f]then e=e+0x01 n[f]=(0xf9);end return true end)'IiWSt'and f[0x1](r+0x307))or(e%0x03==0x1 and(function(f)if not n[f]then e=e+0x01 n[f]=(0x89);l[2]=(l[2]*(z(function()h()end,b(t))-z(l[1],b(t))))+1;h[d]={};l=l[2];d=d+l;end return true end)'YGFSG'and f[0x3](r+0x337))or r end),(function(r)if o>0x24 then return r end o=o+1 e=(e+0xacb-r)%0x4f return(e%0x03==0x0 and(function(f)if not n[f]then e=e+0x01 n[f]=(0xc1);t={t..'\58 a',t};h[d]=ee();d=d+((not a.plrB_tOG)and 1 or 0);t[1]='\58'..t[1];l[2]=0xff;end return true end)'IhUjK'and f[0x1](0x1ca+r))or(e%0x03==0x1 and(function(f)if not n[f]then e=e+0x01 n[f]=(0x8c);t='\37';l={function()l()end};t=t..'\100\43';end return true end)'zvVVZ'and f[0x2](r+0x210))or(e%0x03==0x2 and(function(f)if not n[f]then e=e+0x01 n[f]=(0x81);end return true end)'Zmhtd'and f[0x3](r+0x264))or r end),(function(t)if o>0x2b then return t end o=o+1 e=(e+0xc41-t)%0x2d return(e%0x03==0x0 and(function(f)if not n[f]then e=e+0x01 n[f]=(0x6e);end return true end)'KMbPs'and f[0x1](0x1b1+t))or(e%0x03==0x1 and(function(f)if not n[f]then e=e+0x01 n[f]=(0x57);h[d]=fe();d=d+l;end return true end)'Auhyb'and f[0x3](t+0x26b))or(e%0x03==0x2 and(function(f)if not n[f]then e=e+0x01 n[f]=(0x49);end return true end)'JCrVd'and f[0x2](t+0x151))or t end)}f[0x2](0x1cad)end){};local e=k(b(h));return e(...);end return ne((function()local n={}local e=0x01;local f;if a.plrB_tOG then f=a.plrB_tOG(ne)else f=''end if a.JAr_lLHY(f,a.pajpFRRf)then e=e+0;else e=e+1;end n[e]=0x02;n[n[e]+0x01]=0x03;return n;end)(),...)end)((function(f,e,n,l,t,d)local d;if 3>=f then if 1>=f then if f>=-2 then repeat if 0~=f then do return function(f,e,n)if n then local e=(f/2^(e-1))%2^((n-1)-(e-1)+1);return e-e%1;else local e=2^(e-1);return(f%(e+e)>=e)and 1 or 0;end;end;end;break;end;do return e(1),e(4,t,l,n,e),e(5,t,l,n)end;until true;else do return function(f,e,n)if n then local e=(f/2^(e-1))%2^((n-1)-(e-1)+1);return e-e%1;else local e=2^(e-1);return(f%(e+e)>=e)and 1 or 0;end;end;end;end else if 0<=f then repeat if 3~=f then do return 16777216,65536,256 end;break;end;do return e(1),e(4,t,l,n,e),e(5,t,l,n)end;until true;else do return e(1),e(4,t,l,n,e),e(5,t,l,n)end;end end else if 6>f then if f~=0 then for d=17,68 do if f~=4 then local f=l;do return function()local e=e(n,f(f,f),f(f,f));f(1);return e;end;end;break;end;local f=l;local r,d,o=t(2);do return function()local l,t,n,e=e(n,f(f,f),f(f,f)+3);f(4);return(e*r)+(n*d)+(t*o)+l;end;end;break;end;else local f=l;do return function()local e=e(n,f(f,f),f(f,f));f(1);return e;end;end;end else if f>6 then if f<8 then do return setmetatable({},{['__\99\97\108\108']=function(e,t,l,f,n)if n then return e[n]elseif f then return e else e[t]=l end end})end else do return n(f,nil,n);end end else do return t[n]end;end end end end),...)
`

export async function GET(request: NextRequest) {
  // Generate a random session token for this request (just for tracking)
  const sessionToken = crypto.randomBytes(16).toString("hex")

  // Check if this is a legitimate request from Roblox
  if (isRobloxRequest(request)) {
    try {
      // Add a simple watermark
      const watermark = `-- helopeople:33 [${new Date().toISOString()}]\n`
      let finalScript = watermark + scrypt

      // Compress the script if it's large
      const scriptSize = Buffer.byteLength(finalScript, "utf8")
      if (scriptSize > 1024 * 1024) {
        const compressed = await compressString(finalScript)

        // Create a loader script that decompresses the main script
        finalScript = `
-- Compressed script loader
local compressed = "${encodeBase64(compressed.toString("binary"))}"
local function decompress(data)
  -- Decompress implementation
  return data -- Placeholder, actual implementation would decompress
end

local decompressed = decompress(compressed)
loadstring(decompressed)()
`
      }

      // Return the script with appropriate headers
      return new NextResponse(finalScript, {
        headers: {
          "Content-Type": "text/plain",
          "X-Session-Token": sessionToken,
          "Cache-Control": "no-store, max-age=0",
        },
      })
    } catch (error) {
      console.error("Error generating script:", error)
      return NextResponse.json(
        {
          message: "Internal server error",
          status: "error",
          timestamp: new Date().toISOString(),
          token: sessionToken,
        },
        {
          status: 500,
          headers: {
            "X-Session-Token": sessionToken,
            "Cache-Control": "no-store, max-age=0",
          },
        },
      )
    }
  } else {
    // unauthorized lol
    return NextResponse.json(
      {
        version: "v1",
        message: "skidding is no gud >:((",
        status: "unauthorized",
        token: sessionToken,
      },
      {
        status: 403,
        headers: {
          "X-Session-Token": sessionToken,
          "Cache-Control": "no-store, max-age=0",
        },
      },
    )
  }
}
